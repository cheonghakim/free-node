{"version":3,"file":"free-node.es.js","sources":["../src/core/Registry.js","../src/core/Hooks.js","../src/utils/utils.js","../src/core/Node.js","../src/core/Edge.js","../src/core/Graph.js","../src/render/hitTest.js","../src/render/CanvasRenderer.js","../src/interact/Controller.js","../src/core/Runner.js","../src/index.js"],"sourcesContent":["// src/core/Registry.js\r\nexport class Registry {\r\n  constructor() {\r\n    this.types = new Map();\r\n  }\r\n  register(type, def) {\r\n    // def: {title?, size?, inputs?, outputs?, onCreate?, onExecute?, onDraw?}\r\n    if (this.types.has(type)) throw new Error(`Node type exists: ${type}`);\r\n    this.types.set(type, def);\r\n  }\r\n  createInstance(type) {\r\n    const def = this.types.get(type);\r\n    if (!def) throw new Error(`Unknown node type: ${type}`);\r\n    return def;\r\n  }\r\n}\r\n","export function createHooks(names) {\r\n  const map = Object.fromEntries(names.map((n) => [n, new Set()]));\r\n  return {\r\n    on(name, fn) {\r\n      map[name].add(fn);\r\n      return () => map[name].delete(fn);\r\n    },\r\n    async emit(name, ...args) {\r\n      for (const fn of map[name]) await fn(...args);\r\n    },\r\n  };\r\n}\r\n","export function randomUUID() {\r\n  if (typeof crypto !== \"undefined\" && crypto.randomUUID) {\r\n    // 네이티브 지원\r\n    return crypto.randomUUID();\r\n  }\r\n\r\n  // 네이티브 미지원 → RFC 4122 v4 직접 구현\r\n  const bytes = new Uint8Array(16);\r\n  crypto.getRandomValues(bytes);\r\n\r\n  // RFC4122 version & variant bits 설정\r\n  bytes[6] = (bytes[6] & 0x0f) | 0x40;\r\n  bytes[8] = (bytes[8] & 0x3f) | 0x80;\r\n\r\n  const hex = Array.from(bytes).map((b) => b.toString(16).padStart(2, \"0\"));\r\n\r\n  return (\r\n    hex.slice(0, 4).join(\"\") +\r\n    \"-\" +\r\n    hex.slice(4, 6).join(\"\") +\r\n    \"-\" +\r\n    hex.slice(6, 8).join(\"\") +\r\n    \"-\" +\r\n    hex.slice(8, 10).join(\"\") +\r\n    \"-\" +\r\n    hex.slice(10).join(\"\")\r\n  );\r\n}\r\n","import { randomUUID } from \"../utils/utils.js\";\r\n\r\n// src/core/Node.js\r\nexport class Node {\r\n  constructor({ id, type, title, x = 0, y = 0, width = 160, height = 60 }) {\r\n    this.id = id ?? randomUUID();\r\n    this.type = type;\r\n    this.title = title ?? type;\r\n    this.pos = { x, y };\r\n    this.size = { width, height };\r\n    this.inputs = []; // {id,name,datatype}\r\n    this.outputs = []; // {id,name,datatype}\r\n    this.state = {}; // 사용자 상태\r\n  }\r\n  addInput(name, datatype = \"any\") {\r\n    const port = { id: randomUUID(), name, datatype, dir: \"in\" };\r\n    this.inputs.push(port);\r\n    return port;\r\n  }\r\n  addOutput(name, datatype = \"any\") {\r\n    const port = { id: randomUUID(), name, datatype, dir: \"out\" };\r\n    this.outputs.push(port);\r\n    return port;\r\n  }\r\n}\r\n","import { randomUUID } from \"../utils/utils.js\";\r\n\r\n// src/core/Edge.js\r\nexport class Edge {\r\n  constructor({ id, fromNode, fromPort, toNode, toPort }) {\r\n    this.id = id ?? randomUUID();\r\n    this.fromNode = fromNode;\r\n    this.fromPort = fromPort;\r\n    this.toNode = toNode;\r\n    this.toPort = toPort;\r\n  }\r\n}\r\n","import { Node } from \"./Node.js\";\r\nimport { Edge } from \"./Edge.js\";\r\n\r\nexport class Graph {\r\n  constructor({ hooks, registry }) {\r\n    this.nodes = new Map();\r\n    this.edges = new Map();\r\n    this.hooks = hooks;\r\n    this.registry = registry;\r\n    // double buffer for deterministic cycles\r\n    this._valuesA = new Map(); // current\r\n    this._valuesB = new Map(); // next\r\n    this._useAasCurrent = true;\r\n  }\r\n  addNode(type, opts = {}) {\r\n    const def = this.registry.types.get(type);\r\n    if (!def) throw new Error(`Unknown node type: ${type}`);\r\n    const node = new Node({\r\n      type,\r\n      title: def.title,\r\n      width: def.size?.w,\r\n      height: def.size?.h,\r\n      ...opts,\r\n    });\r\n    for (const i of def.inputs || []) node.addInput(i.name, i.datatype);\r\n    for (const o of def.outputs || []) node.addOutput(o.name, o.datatype);\r\n    def.onCreate?.(node);\r\n    this.nodes.set(node.id, node);\r\n    this.hooks?.emit(\"node:create\", node);\r\n    return node;\r\n  }\r\n  removeNode(nodeId) {\r\n    for (const [eid, e] of this.edges)\r\n      if (e.fromNode === nodeId || e.toNode === nodeId) this.edges.delete(eid);\r\n    this.nodes.delete(nodeId);\r\n  }\r\n  addEdge(fromNode, fromPort, toNode, toPort) {\r\n    const e = new Edge({ fromNode, fromPort, toNode, toPort });\r\n    this.edges.set(e.id, e);\r\n    this.hooks?.emit(\"edge:create\", e);\r\n    return e;\r\n  }\r\n  // buffer helpers\r\n  _curBuf() {\r\n    return this._useAasCurrent ? this._valuesA : this._valuesB;\r\n  }\r\n  _nextBuf() {\r\n    return this._useAasCurrent ? this._valuesB : this._valuesA;\r\n  }\r\n  swapBuffers() {\r\n    // when moving to next cycle, promote next->current and clear next\r\n    this._useAasCurrent = !this._useAasCurrent;\r\n    this._nextBuf().clear();\r\n  }\r\n  // data helpers\r\n  setOutput(nodeId, portId, value) {\r\n    this._nextBuf().set(`${nodeId}:${portId}`, value);\r\n  }\r\n  getInput(nodeId, portId) {\r\n    // find upstream edge feeding this input\r\n    for (const e of this.edges.values()) {\r\n      if (e.toNode === nodeId && e.toPort === portId) {\r\n        return this._curBuf().get(`${e.fromNode}:${e.fromPort}`);\r\n      }\r\n    }\r\n    return undefined;\r\n  }\r\n  toJSON() {\r\n    const json = {\r\n      nodes: [...this.nodes.values()].map((n) => ({\r\n        id: n.id,\r\n        type: n.type,\r\n        title: n.title,\r\n        x: n.pos.x,\r\n        y: n.pos.y,\r\n        w: n.size.width,\r\n        h: n.size.height,\r\n        inputs: n.inputs,\r\n        outputs: n.outputs,\r\n        state: n.state,\r\n      })),\r\n      edges: [...this.edges.values()],\r\n    };\r\n    this.hooks?.emit(\"graph:serialize\", json);\r\n    return json;\r\n  }\r\n  static fromJSON(json, { hooks, registry }) {\r\n    const g = new Graph({ hooks, registry });\r\n    for (const nd of json.nodes) {\r\n      const node = new Node({\r\n        id: nd.id,\r\n        type: nd.type,\r\n        title: nd.title,\r\n        x: nd.x,\r\n        y: nd.y,\r\n        width: nd.w,\r\n        height: nd.h,\r\n      });\r\n      node.inputs = nd.inputs;\r\n      node.outputs = nd.outputs;\r\n      node.state = nd.state || {};\r\n      g.nodes.set(node.id, node);\r\n    }\r\n    for (const ed of json.edges) g.edges.set(ed.id, new Edge(ed));\r\n    return g;\r\n  }\r\n}\r\n","// src/render/hitTest.js\r\nexport function hitTestNode(node, x, y) {\r\n  const { x: nx, y: ny } = node.pos;\r\n  const { width, height } = node.size;\r\n  return x >= nx && x <= nx + width && y >= ny && y <= ny + height;\r\n}\r\nexport function portRect(node, port, idx, dir) {\r\n  const pad = 8,\r\n    row = 20;\r\n  const y = node.pos.y + 28 + idx * row;\r\n  if (dir === \"in\") return { x: node.pos.x - pad, y, w: pad, h: 14 };\r\n  if (dir === \"out\")\r\n    return { x: node.pos.x + node.size.width, y, w: pad, h: 14 };\r\n}\r\n","import { hitTestNode, portRect } from \"./hitTest.js\";\r\n\r\nexport class CanvasRenderer {\r\n  constructor(canvas, { theme = {}, registry, edgeStyle = \"orthogonal\" } = {}) {\r\n    this.canvas = canvas;\r\n    this.ctx = canvas.getContext(\"2d\");\r\n    this.registry = registry; // to call per-node onDraw\r\n\r\n    // viewport transform\r\n    this.scale = 1;\r\n    this.minScale = 0.25;\r\n    this.maxScale = 3;\r\n    this.offsetX = 0;\r\n    this.offsetY = 0;\r\n\r\n    // 'bezier' | 'line' | 'orthogonal'\r\n    this.edgeStyle = edgeStyle;\r\n\r\n    this.theme = Object.assign(\r\n      {\r\n        bg: \"#141417\",\r\n        grid: \"#25252a\",\r\n        node: \"#1e1e24\",\r\n        title: \"#2a2a31\",\r\n        text: \"#e9e9ef\",\r\n        port: \"#8aa1ff\",\r\n        edge: \"#7f8cff\",\r\n      },\r\n      theme\r\n    );\r\n  }\r\n  setEdgeStyle(style) {\r\n    this.edgeStyle =\r\n      style === \"line\" || style === \"orthogonal\" ? style : \"bezier\";\r\n  }\r\n  setRegistry(reg) {\r\n    this.registry = reg;\r\n  }\r\n  resize(w, h) {\r\n    this.canvas.width = w;\r\n    this.canvas.height = h;\r\n  }\r\n  setTransform({\r\n    scale = this.scale,\r\n    offsetX = this.offsetX,\r\n    offsetY = this.offsetY,\r\n  } = {}) {\r\n    this.scale = Math.min(this.maxScale, Math.max(this.minScale, scale));\r\n    this.offsetX = offsetX;\r\n    this.offsetY = offsetY;\r\n  }\r\n  panBy(dx, dy) {\r\n    this.offsetX += dx;\r\n    this.offsetY += dy;\r\n  }\r\n  zoomAt(factor, cx, cy) {\r\n    // factor > 1 zoom in, < 1 zoom out, centered at screen point (cx, cy)\r\n    const prev = this.scale;\r\n    const next = Math.min(\r\n      this.maxScale,\r\n      Math.max(this.minScale, prev * factor)\r\n    );\r\n    if (next === prev) return;\r\n    // keep the world point under cursor fixed: adjust offset\r\n    const wx = (cx - this.offsetX) / prev;\r\n    const wy = (cy - this.offsetY) / prev;\r\n    this.offsetX = cx - wx * next;\r\n    this.offsetY = cy - wy * next;\r\n    this.scale = next;\r\n  }\r\n  _drawArrowhead(x1, y1, x2, y2, size = 10) {\r\n    const { ctx } = this;\r\n    const s = size / this.scale; // 줌에 따라 크기 보정\r\n    const ang = Math.atan2(y2 - y1, x2 - x1);\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(x2, y2);\r\n    ctx.lineTo(\r\n      x2 - s * Math.cos(ang - Math.PI / 6),\r\n      y2 - s * Math.sin(ang - Math.PI / 6)\r\n    );\r\n    ctx.lineTo(\r\n      x2 - s * Math.cos(ang + Math.PI / 6),\r\n      y2 - s * Math.sin(ang + Math.PI / 6)\r\n    );\r\n    ctx.closePath();\r\n    ctx.fill(); // 선 색상과 동일한 fill이 자연스러움\r\n  }\r\n\r\n  screenToWorld(x, y) {\r\n    return {\r\n      x: (x - this.offsetX) / this.scale,\r\n      y: (y - this.offsetY) / this.scale,\r\n    };\r\n  }\r\n  worldToScreen(x, y) {\r\n    return {\r\n      x: x * this.scale + this.offsetX,\r\n      y: y * this.scale + this.offsetY,\r\n    };\r\n  }\r\n\r\n  // ── Drawing ────────────────────────────────────────────────────────────────\r\n  _applyTransform() {\r\n    const { ctx } = this;\r\n    ctx.setTransform(this.scale, 0, 0, this.scale, this.offsetX, this.offsetY);\r\n  }\r\n  _resetTransform() {\r\n    this.ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n  }\r\n\r\n  drawGrid() {\r\n    const { ctx, canvas, theme, scale, offsetX, offsetY } = this;\r\n    // clear screen in screen space\r\n\r\n    this._resetTransform();\r\n    ctx.fillStyle = theme.bg;\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n    // draw grid in world space so it pans/zooms\r\n    this._applyTransform();\r\n    ctx.strokeStyle = theme.grid;\r\n    ctx.lineWidth = 1 / scale; // keep 1px apparent\r\n\r\n    const base = 20; // world units\r\n    const step = base;\r\n\r\n    // visible world bounds\r\n    const x0 = -offsetX / scale;\r\n    const y0 = -offsetY / scale;\r\n    const x1 = (canvas.width - offsetX) / scale;\r\n    const y1 = (canvas.height - offsetY) / scale;\r\n\r\n    const startX = Math.floor(x0 / step) * step;\r\n    const startY = Math.floor(y0 / step) * step;\r\n\r\n    ctx.beginPath();\r\n    for (let x = startX; x <= x1; x += step) {\r\n      ctx.moveTo(x, y0);\r\n      ctx.lineTo(x, y1);\r\n    }\r\n    for (let y = startY; y <= y1; y += step) {\r\n      ctx.moveTo(x0, y);\r\n      ctx.lineTo(x1, y);\r\n    }\r\n    ctx.stroke();\r\n\r\n    this._resetTransform();\r\n  }\r\n\r\n  draw(graph, { selection = new Set(), tempEdge = null } = {}) {\r\n    this.drawGrid();\r\n    console.log(tempEdge);\r\n    const { ctx, theme } = this;\r\n    this._applyTransform();\r\n\r\n    // edges\r\n    ctx.strokeStyle = theme.edge;\r\n    ctx.lineWidth = 2 / this.scale;\r\n    for (const e of graph.edges.values()) this._drawEdge(graph, e);\r\n\r\n    // temp edge (given in screen coords); convert to world if needed\r\n    // draw(graph, { selection, tempEdge }) 내부의 tempEdge 처리 구간만 교체\r\n    if (tempEdge) {\r\n      const a = this.screenToWorld(tempEdge.x1, tempEdge.y1);\r\n      const b = this.screenToWorld(tempEdge.x2, tempEdge.y2);\r\n\r\n      // 점선 프리뷰\r\n      const prevDash = this.ctx.getLineDash();\r\n      this.ctx.setLineDash([6 / this.scale, 6 / this.scale]);\r\n\r\n      let ptsForArrow = null;\r\n      if (this.edgeStyle === \"line\") {\r\n        this._drawLine(a.x, a.y, b.x, b.y);\r\n        ptsForArrow = [\r\n          { x: a.x, y: a.y },\r\n          { x: b.x, y: b.y },\r\n        ];\r\n      } else if (this.edgeStyle === \"orthogonal\") {\r\n        ptsForArrow = this._drawOrthogonal(a.x, a.y, b.x, b.y);\r\n      } else {\r\n        this._drawCurve(a.x, a.y, b.x, b.y);\r\n        ptsForArrow = [\r\n          { x: a.x, y: a.y },\r\n          { x: b.x, y: b.y },\r\n        ];\r\n      }\r\n\r\n      this.ctx.setLineDash(prevDash);\r\n\r\n      // (선택) 화살표 표시: 마지막 세그먼트 방향 사용\r\n      if (ptsForArrow && ptsForArrow.length >= 2) {\r\n        const p1 = ptsForArrow[ptsForArrow.length - 2];\r\n        const p2 = ptsForArrow[ptsForArrow.length - 1];\r\n        this.ctx.fillStyle = this.theme.edge;\r\n        this.ctx.strokeStyle = this.theme.edge;\r\n        this._drawArrowhead(p1.x, p1.y, p2.x, p2.y, 12);\r\n      }\r\n    }\r\n\r\n    // nodes\r\n    for (const n of graph.nodes.values()) {\r\n      const sel = selection.has(n.id);\r\n      this._drawNode(n, sel);\r\n      const def = this.registry?.types?.get(n.type);\r\n      if (def?.onDraw) def.onDraw(n, { ctx, theme });\r\n    }\r\n\r\n    this._resetTransform();\r\n  }\r\n\r\n  _drawNode(node, selected) {\r\n    const { ctx, theme } = this;\r\n    const r = 8;\r\n    const { x, y } = node.pos;\r\n    const { width: w, height: h } = node.size;\r\n    ctx.fillStyle = theme.node;\r\n    ctx.strokeStyle = selected ? \"#6cf\" : \"#333\";\r\n    ctx.lineWidth = (selected ? 2 : 1.2) / this.scale;\r\n    roundRect(ctx, x, y, w, h, r);\r\n    ctx.fill();\r\n    ctx.stroke();\r\n    ctx.fillStyle = theme.title;\r\n    roundRect(ctx, x, y, w, 24, { tl: r, tr: r, br: 0, bl: 0 });\r\n    ctx.fill();\r\n    ctx.fillStyle = theme.text;\r\n    ctx.font = `${12 / this.scale}px system-ui`;\r\n    ctx.fillText(node.title, x + 8, y + 16 / 1);\r\n    ctx.fillStyle = theme.port;\r\n    node.inputs.forEach((p, i) => {\r\n      const rct = portRect(node, p, i, \"in\");\r\n      ctx.fillRect(rct.x, rct.y, rct.w, rct.h);\r\n    });\r\n    node.outputs.forEach((p, i) => {\r\n      const rct = portRect(node, p, i, \"out\");\r\n      ctx.fillRect(rct.x, rct.y, rct.w, rct.h);\r\n    });\r\n  }\r\n\r\n  _drawEdge(graph, e) {\r\n    const from = graph.nodes.get(e.fromNode);\r\n    const to = graph.nodes.get(e.toNode);\r\n    if (!from || !to) return;\r\n    const iOut = from.outputs.findIndex((p) => p.id === e.fromPort);\r\n    const iIn = to.inputs.findIndex((p) => p.id === e.toPort);\r\n    const pr1 = portRect(from, null, iOut, \"out\");\r\n    const pr2 = portRect(to, null, iIn, \"in\");\r\n    const x1 = pr1.x,\r\n      y1 = pr1.y + 7,\r\n      x2 = pr2.x,\r\n      y2 = pr2.y + 7;\r\n    if (this.edgeStyle === \"line\") {\r\n      this._drawLine(x1, y1, x2, y2);\r\n    } else if (this.edgeStyle === \"orthogonal\") {\r\n      this._drawOrthogonal(x1, y1, x2, y2);\r\n    } else {\r\n      this._drawCurve(x1, y1, x2, y2); // bezier (기존)\r\n    }\r\n  }\r\n\r\n  _drawLine(x1, y1, x2, y2) {\r\n    const { ctx } = this;\r\n    ctx.beginPath();\r\n    ctx.moveTo(x1, y1);\r\n    ctx.lineTo(x2, y2);\r\n    ctx.stroke();\r\n  }\r\n\r\n  _drawPolyline(points) {\r\n    const { ctx } = this;\r\n    ctx.beginPath();\r\n    ctx.moveTo(points[0].x, points[0].y);\r\n    for (let i = 1; i < points.length; i++)\r\n      ctx.lineTo(points[i].x, points[i].y);\r\n    ctx.stroke();\r\n  }\r\n\r\n  _drawOrthogonal(x1, y1, x2, y2) {\r\n    const dx = Math.abs(x2 - x1);\r\n    const dy = Math.abs(y2 - y1);\r\n    // 중간 축을 결정 (더 짧은 축을 가운데에 두면 보기 좋음)\r\n    const useHVH = true; // 가로-세로-가로(HVH) vs 세로-가로-세로(VHV)\r\n    const midX = (x1 + x2) / 2;\r\n    const midY = (y1 + y2) / 2;\r\n\r\n    let pts;\r\n    if (useHVH) {\r\n      // x1,y1 → midX,y1 → midX,y2 → x2,y2\r\n      pts = [\r\n        { x: x1, y: y1 },\r\n        { x: midX, y: y1 },\r\n        { x: midX, y: y2 },\r\n        { x: x2, y: y2 },\r\n      ];\r\n    }\r\n    // else {\r\n    //   // x1,y1 → x1,midY → x2,midY → x2,y2\r\n    //   pts = [\r\n    //     { x: x1, y: y1 },\r\n    //     { x: x1, y: midY },\r\n    //     { x: x2, y: midY },\r\n    //     { x: x2, y: y2 },\r\n    //   ];\r\n    // }\r\n\r\n    // 라운드 코너\r\n    const { ctx } = this;\r\n    const prevJoin = ctx.lineJoin,\r\n      prevCap = ctx.lineCap;\r\n    ctx.lineJoin = \"round\";\r\n    ctx.lineCap = \"round\";\r\n    this._drawPolyline(pts);\r\n    ctx.lineJoin = prevJoin;\r\n    ctx.lineCap = prevCap;\r\n\r\n    return pts; // 화살표 각도 계산에 사용\r\n  }\r\n  _drawCurve(x1, y1, x2, y2) {\r\n    const { ctx } = this;\r\n    const dx = Math.max(40, Math.abs(x2 - x1) * 0.4);\r\n    ctx.beginPath();\r\n    ctx.moveTo(x1, y1);\r\n    ctx.bezierCurveTo(x1 + dx, y1, x2 - dx, y2, x2, y2);\r\n    ctx.stroke();\r\n  }\r\n}\r\nfunction roundRect(ctx, x, y, w, h, r = 6) {\r\n  if (typeof r === \"number\") r = { tl: r, tr: r, br: r, bl: r };\r\n  ctx.beginPath();\r\n  ctx.moveTo(x + r.tl, y);\r\n  ctx.lineTo(x + w - r.tr, y);\r\n  ctx.quadraticCurveTo(x + w, y, x + w, y + r.tr);\r\n  ctx.lineTo(x + w, y + h - r.br);\r\n  ctx.quadraticCurveTo(x + w, y + h, x + w - r.br, y + h);\r\n  ctx.lineTo(x + r.bl, y + h);\r\n  ctx.quadraticCurveTo(x, y + h, x, y + h - r.bl);\r\n  ctx.lineTo(x, y + r.tl);\r\n  ctx.quadraticCurveTo(x, y, x + r.tl, y);\r\n  ctx.closePath();\r\n}\r\n","import { hitTestNode, portRect } from \"../render/hitTest.js\";\r\n\r\nexport class Controller {\r\n  constructor({ graph, renderer, hooks }) {\r\n    this.graph = graph;\r\n    this.renderer = renderer;\r\n    this.hooks = hooks;\r\n\r\n    this.selection = new Set();\r\n    this.dragging = null; // { nodeId, dx, dy }\r\n    this.connecting = null; // { fromNode, fromPort, x(screen), y(screen) }\r\n    this.panning = null; // { x(screen), y(screen) }\r\n\r\n    this._cursor = \"default\";\r\n\r\n    this._bindEvents();\r\n  }\r\n\r\n  _bindEvents() {\r\n    const c = this.renderer.canvas;\r\n    c.addEventListener(\"mousedown\", (e) => this._onDown(e));\r\n    window.addEventListener(\"mousemove\", (e) => this._onMove(e));\r\n    window.addEventListener(\"mouseup\", (e) => this._onUp(e));\r\n    // 더블클릭으로 노드 생성하지 않음 (요청 사항)\r\n    // c.addEventListener(\"dblclick\", (e) => this._onDbl(e));\r\n    c.addEventListener(\"wheel\", (e) => this._onWheel(e), { passive: false });\r\n\r\n    // 필요 시 우클릭 패닝을 원하면 이걸 켜세요.\r\n    // c.addEventListener(\"contextmenu\", e => e.preventDefault());\r\n  }\r\n\r\n  _setCursor(c) {\r\n    if (this._cursor !== c) {\r\n      this._cursor = c;\r\n      this.renderer.canvas.style.cursor = c;\r\n    }\r\n  }\r\n\r\n  _posScreen(e) {\r\n    const r = this.renderer.canvas.getBoundingClientRect();\r\n    return { x: e.clientX - r.left, y: e.clientY - r.top };\r\n  }\r\n\r\n  _posWorld(e) {\r\n    const s = this._posScreen(e);\r\n    return this.renderer.screenToWorld(s.x, s.y);\r\n  }\r\n\r\n  _findNodeAtWorld(x, y) {\r\n    const list = [...this.graph.nodes.values()];\r\n    for (let i = list.length - 1; i >= 0; i--) {\r\n      const n = list[i];\r\n      if (hitTestNode(n, x, y)) return n;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _findPortAtWorld(x, y) {\r\n    for (const n of this.graph.nodes.values()) {\r\n      for (let i = 0; i < n.inputs.length; i++) {\r\n        const r = portRect(n, n.inputs[i], i, \"in\");\r\n        if (rectHas(r, x, y))\r\n          return { node: n, port: n.inputs[i], dir: \"in\", idx: i };\r\n      }\r\n      for (let i = 0; i < n.outputs.length; i++) {\r\n        const r = portRect(n, n.outputs[i], i, \"out\");\r\n        if (rectHas(r, x, y))\r\n          return { node: n, port: n.outputs[i], dir: \"out\", idx: i };\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _onWheel(e) {\r\n    e.preventDefault();\r\n    const { x, y } = this._posScreen(e);\r\n    const factor = Math.pow(1.0015, -e.deltaY); // smooth zoom\r\n    this.renderer.zoomAt(factor, x, y);\r\n    this.render();\r\n  }\r\n\r\n  _findIncomingEdge(nodeId, portId) {\r\n    for (const [eid, e] of this.graph.edges) {\r\n      if (e.toNode === nodeId && e.toPort === portId) {\r\n        return { id: eid, edge: e };\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _onDown(e) {\r\n    const s = this._posScreen(e);\r\n    const w = this._posWorld(e);\r\n\r\n    // 0) MMB(휠 버튼) 드래그는 항상 패닝\r\n    if (e.button === 1) {\r\n      this.panning = { x: s.x, y: s.y };\r\n      return;\r\n    }\r\n\r\n    // 1) 포트(OUT) 위 좌클릭이면 연결 시작\r\n    const port = this._findPortAtWorld(w.x, w.y);\r\n    if (e.button === 0 && port && port.dir === \"out\") {\r\n      const outR = portRect(port.node, port.port, port.idx, \"out\");\r\n      const screenFrom = this.renderer.worldToScreen(outR.x, outR.y + 7);\r\n      this.connecting = {\r\n        fromNode: port.node.id,\r\n        fromPort: port.port.id,\r\n        x: screenFrom.x,\r\n        y: screenFrom.y,\r\n      };\r\n      return;\r\n    }\r\n\r\n    if (e.button === 0 && port && port.dir === \"in\") {\r\n      const incoming = this._findIncomingEdge(port.node.id, port.port.id);\r\n      if (incoming) {\r\n        // 원래 소스 쪽에서 다시 끌어오도록, 엣지를 임시 삭제\r\n        const { edge, id } = incoming;\r\n        this.graph.edges.delete(id);\r\n        const outR = portRect(\r\n          this.graph.nodes.get(edge.fromNode),\r\n          this.graph.nodes\r\n            .get(edge.fromNode)\r\n            .outputs.find((p) => p.id === edge.fromPort),\r\n          this.graph.nodes\r\n            .get(edge.fromNode)\r\n            .outputs.findIndex((p) => p.id === edge.fromPort),\r\n          \"out\"\r\n        );\r\n        const screenFrom = this.renderer.worldToScreen(outR.x, outR.y + 7);\r\n        this.connecting = {\r\n          fromNode: edge.fromNode,\r\n          fromPort: edge.fromPort,\r\n          x: screenFrom.x,\r\n          y: screenFrom.y,\r\n          // 표시용: 끊어낸 대상 인풋\r\n          _rewireFromEdgeId: id,\r\n        };\r\n        this.render();\r\n        return;\r\n      }\r\n      // 들어오는 엣지가 없으면 그냥 무시\r\n    }\r\n\r\n    // 2) 노드 위 좌클릭이면 선택 전환 + 드래그 시작\r\n    const node = this._findNodeAtWorld(w.x, w.y);\r\n    if (e.button === 0 && node) {\r\n      if (!e.shiftKey) this.selection.clear();\r\n      this.selection.add(node.id);\r\n      this.dragging = {\r\n        nodeId: node.id,\r\n        dx: w.x - node.pos.x,\r\n        dy: w.y - node.pos.y,\r\n      };\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    // 3) 빈 공간 좌클릭이면: 선택 해제 + 패닝 시작\r\n    if (e.button === 0) {\r\n      if (this.selection.size) this.selection.clear();\r\n      this.panning = { x: s.x, y: s.y };\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    // 기타는 무시\r\n  }\r\n\r\n  _onMove(e) {\r\n    const s = this._posScreen(e);\r\n    const w = this.renderer.screenToWorld(s.x, s.y);\r\n\r\n    if (this.panning) {\r\n      const dx = s.x - this.panning.x;\r\n      const dy = s.y - this.panning.y;\r\n      this.panning = { x: s.x, y: s.y };\r\n      this.renderer.panBy(dx, dy);\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    if (this.dragging) {\r\n      const n = this.graph.nodes.get(this.dragging.nodeId);\r\n      n.pos.x = w.x - this.dragging.dx;\r\n      n.pos.y = w.y - this.dragging.dy;\r\n      this.hooks?.emit(\"node:move\", n);\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    // 연결 드래그 프리뷰: 화면 좌표로 저장\r\n    if (this.connecting) {\r\n      this.connecting.x = s.x;\r\n      this.connecting.y = s.y;\r\n      this.render();\r\n    }\r\n\r\n    const port = this._findPortAtWorld(w.x, w.y);\r\n    if (port && (port.dir === \"out\" || port.dir === \"in\")) {\r\n      this._setCursor(\"grabbing\");\r\n    } else {\r\n      this._setCursor(\"default\");\r\n    }\r\n  }\r\n\r\n  _onUp(e) {\r\n    const s = this._posScreen(e);\r\n    const w = this._posWorld(e);\r\n\r\n    if (this.panning) {\r\n      this.panning = null;\r\n      return;\r\n    }\r\n\r\n    if (this.connecting) {\r\n      const from = this.connecting;\r\n      const portIn = this._findPortAtWorld(w.x, w.y);\r\n      if (portIn && portIn.dir === \"in\") {\r\n        this.graph.addEdge(\r\n          from.fromNode,\r\n          from.fromPort,\r\n          portIn.node.id,\r\n          portIn.port.id\r\n        );\r\n      }\r\n      this.connecting = null;\r\n      this.render();\r\n    }\r\n\r\n    this.dragging = null;\r\n  }\r\n\r\n  render() {\r\n    const tEdge = this.connecting\r\n      ? (() => {\r\n          const a = this._portAnchorScreen(\r\n            this.connecting.fromNode,\r\n            this.connecting.fromPort\r\n          ); // {x,y}\r\n          const b = { x: this.connecting.x, y: this.connecting.y }; // {x,y}\r\n          return { x1: a.x, y1: a.y, x2: b.x, y2: b.y }; // 명시적으로 x1,y1,x2,y2 구성\r\n        })()\r\n      : null;\r\n\r\n    this.renderer.draw(this.graph, {\r\n      selection: this.selection,\r\n      tempEdge: tEdge, // 그대로 전달\r\n    });\r\n  }\r\n\r\n  _portAnchorScreen(nodeId, portId) {\r\n    const n = this.graph.nodes.get(nodeId);\r\n    const iOut = n.outputs.findIndex((p) => p.id === portId);\r\n    const r = portRect(n, null, iOut, \"out\"); // world rect\r\n    return this.renderer.worldToScreen(r.x, r.y + 7); // -> screen point\r\n  }\r\n}\r\n\r\nfunction rectHas(r, x, y) {\r\n  return x >= r.x && x <= r.x + r.w && y >= r.y && y <= r.y + r.h;\r\n}\r\n","export class Runner {\r\n  constructor({ graph, registry, hooks, cyclesPerFrame = 1 }) {\r\n    this.graph = graph;\r\n    this.registry = registry;\r\n    this.hooks = hooks;\r\n    this.running = false;\r\n    this._raf = null;\r\n    this._last = 0;\r\n    this.cyclesPerFrame = Math.max(1, cyclesPerFrame | 0);\r\n  }\r\n  step(cycles = 1, dt = 0) {\r\n    const nCycles = Math.max(1, cycles | 0);\r\n    for (let c = 0; c < nCycles; c++) {\r\n      for (const node of this.graph.nodes.values()) {\r\n        const def = this.registry.types.get(node.type);\r\n        if (def?.onExecute) {\r\n          try {\r\n            def.onExecute(node, {\r\n              dt,\r\n              graph: this.graph,\r\n              getInput: (portName) => {\r\n                const p =\r\n                  node.inputs.find((i) => i.name === portName) ||\r\n                  node.inputs[0];\r\n                return p ? this.graph.getInput(node.id, p.id) : undefined;\r\n              },\r\n              setOutput: (portName, value) => {\r\n                const p =\r\n                  node.outputs.find((o) => o.name === portName) ||\r\n                  node.outputs[0];\r\n                if (p) this.graph.setOutput(node.id, p.id, value);\r\n              },\r\n            });\r\n          } catch (err) {\r\n            this.hooks?.emit(\"error\", err);\r\n          }\r\n        }\r\n      }\r\n      // commit writes for this cycle\r\n      this.graph.swapBuffers();\r\n    }\r\n  }\r\n  start() {\r\n    if (this.running) return;\r\n    this.running = true;\r\n    const step = (t) => {\r\n      if (!this.running) return;\r\n      const dt = this._last ? (t - this._last) / 1000 : 0; // seconds\r\n      this._last = t;\r\n      this.step(this.cyclesPerFrame, dt);\r\n      this._raf = requestAnimationFrame(step);\r\n    };\r\n    this._raf = requestAnimationFrame(step);\r\n  }\r\n  stop() {\r\n    this.running = false;\r\n    if (this._raf) cancelAnimationFrame(this._raf);\r\n    this._raf = null;\r\n    this._last = 0;\r\n  }\r\n}\r\n","import { Registry } from \"./core/Registry.js\";\r\nimport { createHooks } from \"./core/Hooks.js\";\r\nimport { Graph } from \"./core/Graph.js\";\r\nimport { CanvasRenderer } from \"./render/CanvasRenderer.js\";\r\nimport { Controller } from \"./interact/Controller.js\";\r\nimport { Runner } from \"./core/Runner.js\";\r\n\r\nexport function createGraphEditor(\r\n  canvas,\r\n  { theme, hooks: customHooks, autorun = true } = {}\r\n) {\r\n  const hooks =\r\n    customHooks ??\r\n    createHooks([\r\n      \"node:create\",\r\n      \"node:move\",\r\n      \"edge:create\",\r\n      \"edge:delete\",\r\n      \"graph:serialize\",\r\n      \"error\",\r\n    ]);\r\n  const registry = new Registry();\r\n  const graph = new Graph({ hooks, registry });\r\n  const renderer = new CanvasRenderer(canvas, { theme, registry });\r\n  const controller = new Controller({ graph, renderer, hooks });\r\n  const runner = new Runner({ graph, registry, hooks });\r\n\r\n  // default node\r\n  registry.register(\"core/Note\", {\r\n    title: \"Note\",\r\n    size: { w: 180, h: 80 },\r\n    inputs: [{ name: \"in\", datatype: \"any\" }],\r\n    outputs: [{ name: \"out\", datatype: \"any\" }],\r\n    onCreate(node) {\r\n      node.state.text = \"hello\";\r\n    },\r\n    onExecute(node, { dt, getInput, setOutput }) {\r\n      // Simple passthrough with uppercase and a heartbeat value\r\n      const incoming = getInput(\"in\");\r\n      const out = (incoming ?? node.state.text ?? \"\").toString().toUpperCase();\r\n      setOutput(\r\n        \"out\",\r\n        out + ` · ${Math.floor((performance.now() / 1000) % 100)}`\r\n      );\r\n    },\r\n    onDraw(node, { ctx, theme }) {\r\n      const pr = 8;\r\n      const { x, y } = node.pos;\r\n      const { width: w } = node.size;\r\n      ctx.fillStyle = theme.text;\r\n      ctx.font = \"11px system-ui\";\r\n      ctx.fillText(node.state.text ?? \"hello\", x + pr, y + 40);\r\n    },\r\n  });\r\n\r\n  // initial render & resize\r\n\r\n  renderer.resize(canvas.clientWidth, canvas.clientHeight);\r\n  controller.render();\r\n\r\n  const ro = new ResizeObserver(() => {\r\n    renderer.resize(canvas.clientWidth, canvas.clientHeight);\r\n    controller.render();\r\n  });\r\n  ro.observe(canvas);\r\n\r\n  const api = {\r\n    graph,\r\n    renderer,\r\n    controller,\r\n    hooks,\r\n    registry,\r\n    runner,\r\n    addNode: (...args) => graph.addNode(...args),\r\n    toJSON: () => graph.toJSON(),\r\n    fromJSON: (data) => Graph.fromJSON(data, { hooks, registry }),\r\n    resize: (w, h) => renderer.resize(w, h),\r\n    render: () => controller.render(),\r\n    start: () => runner.start(),\r\n    stop: () => runner.stop(),\r\n    destroy: () => {\r\n      runner.stop();\r\n      ro.disconnect();\r\n    },\r\n  };\r\n\r\n  if (autorun) runner.start();\r\n  return api;\r\n}\r\n"],"names":["theme"],"mappings":"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"}